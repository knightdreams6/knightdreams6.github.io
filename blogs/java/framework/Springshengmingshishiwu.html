<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>Spring声明式事务 | Knightdreams'Blog</title><meta name="description" content="Blog">
    <link rel="modulepreload" href="/assets/app-738c8638.js"><link rel="modulepreload" href="/assets/Springshengmingshishiwu.html-d724dd70.js"><link rel="modulepreload" href="/assets/Springshengmingshishiwu.html-3ca2bf08.js"><link rel="prefetch" href="/assets/index.html-0a05feab.js" as="script"><link rel="prefetch" href="/assets/index.html-8c2edf06.js" as="script"><link rel="prefetch" href="/assets/index.html-4b3ba946.js" as="script"><link rel="prefetch" href="/assets/index.html-051f986d.js" as="script"><link rel="prefetch" href="/assets/index.html-ca578b98.js" as="script"><link rel="prefetch" href="/assets/index.html-0bb65ab7.js" as="script"><link rel="prefetch" href="/assets/index.html-4204965d.js" as="script"><link rel="prefetch" href="/assets/index.html-55a77791.js" as="script"><link rel="prefetch" href="/assets/index.html-2ceaa43c.js" as="script"><link rel="prefetch" href="/assets/index.html-a2578442.js" as="script"><link rel="prefetch" href="/assets/index.html-2b8b2faa.js" as="script"><link rel="prefetch" href="/assets/index.html-5e53650f.js" as="script"><link rel="prefetch" href="/assets/index.html-1d285bfc.js" as="script"><link rel="prefetch" href="/assets/index.html-f03dc1d2.js" as="script"><link rel="prefetch" href="/assets/index.html-cfc01373.js" as="script"><link rel="prefetch" href="/assets/index.html-ff18e998.js" as="script"><link rel="prefetch" href="/assets/index.html-46a92963.js" as="script"><link rel="prefetch" href="/assets/index.html-10993ac1.js" as="script"><link rel="prefetch" href="/assets/index.html-1a64e81c.js" as="script"><link rel="prefetch" href="/assets/index.html-743cadcd.js" as="script"><link rel="prefetch" href="/assets/index.html-138b6510.js" as="script"><link rel="prefetch" href="/assets/index.html-db045277.js" as="script"><link rel="prefetch" href="/assets/index.html-d4810458.js" as="script"><link rel="prefetch" href="/assets/index.html-93b00c29.js" as="script"><link rel="prefetch" href="/assets/index.html-bd12e174.js" as="script"><link rel="prefetch" href="/assets/index.html-ed5792c1.js" as="script"><link rel="prefetch" href="/assets/index.html-9eb1513a.js" as="script"><link rel="prefetch" href="/assets/index.html-9db08046.js" as="script"><link rel="prefetch" href="/assets/index.html-dbe1e240.js" as="script"><link rel="prefetch" href="/assets/index.html-f3f14f09.js" as="script"><link rel="prefetch" href="/assets/index.html-3dd4ee6c.js" as="script"><link rel="prefetch" href="/assets/index.html-8838a9fa.js" as="script"><link rel="prefetch" href="/assets/index.html-7053b800.js" as="script"><link rel="prefetch" href="/assets/index.html-b35cc598.js" as="script"><link rel="prefetch" href="/assets/index.html-4e418448.js" as="script"><link rel="prefetch" href="/assets/index.html-8186470d.js" as="script"><link rel="prefetch" href="/assets/index.html-5c65c28e.js" as="script"><link rel="prefetch" href="/assets/index.html-b57fc99d.js" as="script"><link rel="prefetch" href="/assets/index.html-8c17c2e9.js" as="script"><link rel="prefetch" href="/assets/index.html-85c02b49.js" as="script"><link rel="prefetch" href="/assets/index.html-30840ab5.js" as="script"><link rel="prefetch" href="/assets/index.html-a1d115fd.js" as="script"><link rel="prefetch" href="/assets/index.html-6cf06f14.js" as="script"><link rel="prefetch" href="/assets/index.html-1a88d37b.js" as="script"><link rel="prefetch" href="/assets/index.html-c8e98ed0.js" as="script"><link rel="prefetch" href="/assets/index.html-800887e5.js" as="script"><link rel="prefetch" href="/assets/index.html-06f5ab5e.js" as="script"><link rel="prefetch" href="/assets/index.html-5d669565.js" as="script"><link rel="prefetch" href="/assets/index.html-cda0070c.js" as="script"><link rel="prefetch" href="/assets/index.html-fe378dda.js" as="script"><link rel="prefetch" href="/assets/index.html-b0c0ab22.js" as="script"><link rel="prefetch" href="/assets/resume.html-ac530e54.js" as="script"><link rel="prefetch" href="/assets/RedisyuMySQLshuangxieyizhixingruhebaozheng.html-a8e21231.js" as="script"><link rel="prefetch" href="/assets/hulianwangjiagouweishimeyaozuoweifuwuhua.html-c5b97bc7.js" as="script"><link rel="prefetch" href="/assets/hulianwangjiagou，ruhejinxingrongliangsheji.html-42a8471e.js" as="script"><link rel="prefetch" href="/assets/fenbushiyuweifuwuqubie.html-977dfb98.js" as="script"><link rel="prefetch" href="/assets/miaoshaxitongjiagouyouhuasilu.html-f9a65bec.js" as="script"><link rel="prefetch" href="/assets/fenbushishiwu.html-0448d243.js" as="script"><link rel="prefetch" href="/assets/yasuosuanfa.html-c87e76f5.js" as="script"><link rel="prefetch" href="/assets/fanxiangdaili.html-839fe5d2.js" as="script"><link rel="prefetch" href="/assets/shujukushiwu.html-467f3d9f.js" as="script"><link rel="prefetch" href="/assets/lingyuqudongsheji.html-e35e095a.js" as="script"><link rel="prefetch" href="/assets/winsock.html-12fd3fb8.js" as="script"><link rel="prefetch" href="/assets/jiazaidll.html-30282882.js" as="script"><link rel="prefetch" href="/assets/duquchuankoushuju.html-5b88e5ee.js" as="script"><link rel="prefetch" href="/assets/dockerFile.html-c699d781.js" as="script"><link rel="prefetch" href="/assets/dockerxiugaijingxiang.html-025f18d9.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangRabbitMQ.html-20ac0b0f.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangelasticsearch.html-7d297978.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangmysql.html-dd1a5d17.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangmysqlzhucongfuzhi.html-ec47b963.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangnginx.html-29b45517.js" as="script"><link rel="prefetch" href="/assets/CopyOnWriteArrayList.html-012a9813.js" as="script"><link rel="prefetch" href="/assets/ForkJoinPool.html-e68bedf2.js" as="script"><link rel="prefetch" href="/assets/JDBC.html-f26af4b3.js" as="script"><link rel="prefetch" href="/assets/OOM.html-016905fb.js" as="script"><link rel="prefetch" href="/assets/Stringleishejichengbukebiandeyuanyin.html-8cc2435c.js" as="script"><link rel="prefetch" href="/assets/javaSEyinandian.html-a2be0fcf.js" as="script"><link rel="prefetch" href="/assets/javaSEmianshiti（yi）.html-781e30b1.js" as="script"><link rel="prefetch" href="/assets/javaSEmianshiti（er）.html-7a69b90d.js" as="script"><link rel="prefetch" href="/assets/javanacunquyu.html-a3f1c83b.js" as="script"><link rel="prefetch" href="/assets/javasuodefenlei.html-4ab806c1.js" as="script"><link rel="prefetch" href="/assets/jvmmianshiti.html-75db660c.js" as="script"><link rel="prefetch" href="/assets/synchronizedsuo.html-cafa13f3.js" as="script"><link rel="prefetch" href="/assets/volatileguanjianzi.html-b78e78d9.js" as="script"><link rel="prefetch" href="/assets/duixiangchuangjiandeguocheng.html-59b8add9.js" as="script"><link rel="prefetch" href="/assets/shuzu.html-eb60b3b5.js" as="script"><link rel="prefetch" href="/assets/zhengqueshiyongequalsfangfa.html-9a0f8bf6.js" as="script"><link rel="prefetch" href="/assets/xianchengchi.html-8e46531a.js" as="script"><link rel="prefetch" href="/assets/Redisnacunmanliaozenmeban.html-e5a4e7eb.js" as="script"><link rel="prefetch" href="/assets/rabbitmqduilieyujiaohuanji.html-97cf85ea.js" as="script"><link rel="prefetch" href="/assets/rediszhucongfuzhidekang.html-08aa6b06.js" as="script"><link rel="prefetch" href="/assets/redisminglingchangjiandekang.html-59ea67f0.js" as="script"><link rel="prefetch" href="/assets/redisshujuchijiuhuadekang.html-a62caa79.js" as="script"><link rel="prefetch" href="/assets/redisdenacuntaotaijizhi.html-f78c373d.js" as="script"><link rel="prefetch" href="/assets/redisgaojitexing-weicaozuo.html-05dc22a9.js" as="script"><link rel="prefetch" href="/assets/daodishimeshihougaiyongmq.html-70092dbd.js" as="script"><link rel="prefetch" href="/assets/mysqlzhucongfuzhi.html-d6451204.js" as="script"><link rel="prefetch" href="/assets/mysqlshujuqianyi.html-9692c0d4.js" as="script"><link rel="prefetch" href="/assets/mysqlsuoyinyuyouhua.html-da86bb87.js" as="script"><link rel="prefetch" href="/assets/mysqlbianmayuzifuji.html-f1fe813d.js" as="script"><link rel="prefetch" href="/assets/mysqlbiaosuoyuxingsuo.html-5ff3e63d.js" as="script"><link rel="prefetch" href="/assets/mysqldiaoyou.html-94fc3177.js" as="script"><link rel="prefetch" href="/assets/nginxshiyongchangjingyuxiangguangainian.html-077b4b9d.js" as="script"><link rel="prefetch" href="/assets/nginxchangyongpeizhi.html-3c509307.js" as="script"><link rel="prefetch" href="/assets/nginxpeizhiyufa.html-30b829e2.js" as="script"><link rel="prefetch" href="/assets/Single thread vs child process vs worker threads vs cluster in nodejs.html-9d13805e.js" as="script"><link rel="prefetch" href="/assets/DNS.html-80a212c4.js" as="script"><link rel="prefetch" href="/assets/MQTT.html-ca9b92ec.js" as="script"><link rel="prefetch" href="/assets/oauth2.html-a26b53cd.js" as="script"><link rel="prefetch" href="/assets/oidc.html-9f7d084c.js" as="script"><link rel="prefetch" href="/assets/pipyuangenghuan.html-c8b6f42b.js" as="script"><link rel="prefetch" href="/assets/pythondajianMiniotuchuang.html-6fd6b927.js" as="script"><link rel="prefetch" href="/assets/stlmoxingjianmian.html-3400764f.js" as="script"><link rel="prefetch" href="/assets/ModelAttributezhujiedeshiyong.html-a24f0927.js" as="script"><link rel="prefetch" href="/assets/Mybatisyiduiduo，duoduiyichaxun.html-dd260a08.js" as="script"><link rel="prefetch" href="/assets/Mybatisyijihuancun.html-964525e4.js" as="script"><link rel="prefetch" href="/assets/MybatiszhixingyitiaoSqlyujudeliucheng.html-ea05a6e5.js" as="script"><link rel="prefetch" href="/assets/ResourceyuAutowiredzhujiedequbie.html-5d473b14.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-1a4f35be.js" as="script"><link rel="prefetch" href="/assets/Springboot-quartzdingshirenwu.html-500fb106.js" as="script"><link rel="prefetch" href="/assets/SpringzhongBeandeshengmingzhouqi.html-638cf70c.js" as="script"><link rel="prefetch" href="/assets/activitiliuchengyinqing.html-39271f27.js" as="script"><link rel="prefetch" href="/assets/linuxyuwindowsqidongspringbootmingling.html-042605bb.js" as="script"><link rel="prefetch" href="/assets/mavenmingling.html-78b39a49.js" as="script"><link rel="prefetch" href="/assets/springbootfasongyoujian.html-4301a946.js" as="script"><link rel="prefetch" href="/assets/ByteBuddy.html-53656e44.js" as="script"><link rel="prefetch" href="/assets/Reflections.html-5099ad71.js" as="script"><link rel="prefetch" href="/assets/seata.html-92360200.js" as="script"><link rel="prefetch" href="/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/assets/index.html-60ccaa90.js" as="script"><link rel="prefetch" href="/assets/index.html-5d85471d.js" as="script"><link rel="prefetch" href="/assets/index.html-f18754ed.js" as="script"><link rel="prefetch" href="/assets/index.html-3aee9ef5.js" as="script"><link rel="prefetch" href="/assets/index.html-4189daa7.js" as="script"><link rel="prefetch" href="/assets/index.html-14ec5f84.js" as="script"><link rel="prefetch" href="/assets/index.html-5a427d7c.js" as="script"><link rel="prefetch" href="/assets/index.html-87b91edc.js" as="script"><link rel="prefetch" href="/assets/index.html-0b1f991c.js" as="script"><link rel="prefetch" href="/assets/index.html-14afada5.js" as="script"><link rel="prefetch" href="/assets/index.html-a7c63261.js" as="script"><link rel="prefetch" href="/assets/index.html-9d350c39.js" as="script"><link rel="prefetch" href="/assets/index.html-daaab035.js" as="script"><link rel="prefetch" href="/assets/index.html-155c0ac1.js" as="script"><link rel="prefetch" href="/assets/index.html-6f24118c.js" as="script"><link rel="prefetch" href="/assets/index.html-f018f2ed.js" as="script"><link rel="prefetch" href="/assets/index.html-473662e8.js" as="script"><link rel="prefetch" href="/assets/index.html-1b38abb8.js" as="script"><link rel="prefetch" href="/assets/index.html-5d38cd78.js" as="script"><link rel="prefetch" href="/assets/index.html-316e62c7.js" as="script"><link rel="prefetch" href="/assets/index.html-c0b30603.js" as="script"><link rel="prefetch" href="/assets/index.html-83aaf216.js" as="script"><link rel="prefetch" href="/assets/index.html-5befbf16.js" as="script"><link rel="prefetch" href="/assets/index.html-cba74013.js" as="script"><link rel="prefetch" href="/assets/index.html-468de9ca.js" as="script"><link rel="prefetch" href="/assets/index.html-fc9a766d.js" as="script"><link rel="prefetch" href="/assets/index.html-317439ee.js" as="script"><link rel="prefetch" href="/assets/index.html-b63285b5.js" as="script"><link rel="prefetch" href="/assets/index.html-f15dfe36.js" as="script"><link rel="prefetch" href="/assets/index.html-6d3f33cc.js" as="script"><link rel="prefetch" href="/assets/index.html-6daf8699.js" as="script"><link rel="prefetch" href="/assets/index.html-6ef74a70.js" as="script"><link rel="prefetch" href="/assets/index.html-622dcd2c.js" as="script"><link rel="prefetch" href="/assets/index.html-9d58046a.js" as="script"><link rel="prefetch" href="/assets/index.html-3d016826.js" as="script"><link rel="prefetch" href="/assets/index.html-35f47fd4.js" as="script"><link rel="prefetch" href="/assets/index.html-b23c3526.js" as="script"><link rel="prefetch" href="/assets/index.html-6c60b3f5.js" as="script"><link rel="prefetch" href="/assets/index.html-54d6adbd.js" as="script"><link rel="prefetch" href="/assets/index.html-d0309237.js" as="script"><link rel="prefetch" href="/assets/index.html-35989d19.js" as="script"><link rel="prefetch" href="/assets/index.html-79873c80.js" as="script"><link rel="prefetch" href="/assets/index.html-c9cd5b7d.js" as="script"><link rel="prefetch" href="/assets/index.html-47773671.js" as="script"><link rel="prefetch" href="/assets/index.html-5bb8aff7.js" as="script"><link rel="prefetch" href="/assets/index.html-a5822362.js" as="script"><link rel="prefetch" href="/assets/index.html-90716fdf.js" as="script"><link rel="prefetch" href="/assets/index.html-ee106c78.js" as="script"><link rel="prefetch" href="/assets/index.html-3ee0bdba.js" as="script"><link rel="prefetch" href="/assets/index.html-2b4734a8.js" as="script"><link rel="prefetch" href="/assets/index.html-c7fdfba0.js" as="script"><link rel="prefetch" href="/assets/resume.html-32a12d17.js" as="script"><link rel="prefetch" href="/assets/RedisyuMySQLshuangxieyizhixingruhebaozheng.html-4408e779.js" as="script"><link rel="prefetch" href="/assets/hulianwangjiagouweishimeyaozuoweifuwuhua.html-7dd567c6.js" as="script"><link rel="prefetch" href="/assets/hulianwangjiagou，ruhejinxingrongliangsheji.html-9a8cba8e.js" as="script"><link rel="prefetch" href="/assets/fenbushiyuweifuwuqubie.html-353502d5.js" as="script"><link rel="prefetch" href="/assets/miaoshaxitongjiagouyouhuasilu.html-a95e07ed.js" as="script"><link rel="prefetch" href="/assets/fenbushishiwu.html-86465d6e.js" as="script"><link rel="prefetch" href="/assets/yasuosuanfa.html-b301ba23.js" as="script"><link rel="prefetch" href="/assets/fanxiangdaili.html-f70bb7c7.js" as="script"><link rel="prefetch" href="/assets/shujukushiwu.html-082d5280.js" as="script"><link rel="prefetch" href="/assets/lingyuqudongsheji.html-da67ef5b.js" as="script"><link rel="prefetch" href="/assets/winsock.html-9e8cbb9a.js" as="script"><link rel="prefetch" href="/assets/jiazaidll.html-735c542f.js" as="script"><link rel="prefetch" href="/assets/duquchuankoushuju.html-c3543c60.js" as="script"><link rel="prefetch" href="/assets/dockerFile.html-05392f39.js" as="script"><link rel="prefetch" href="/assets/dockerxiugaijingxiang.html-aa3a55c2.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangRabbitMQ.html-de6dd4eb.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangelasticsearch.html-48a798a7.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangmysql.html-d1dfa653.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangmysqlzhucongfuzhi.html-693a574e.js" as="script"><link rel="prefetch" href="/assets/dockeranzhuangnginx.html-51b53350.js" as="script"><link rel="prefetch" href="/assets/CopyOnWriteArrayList.html-83f48a41.js" as="script"><link rel="prefetch" href="/assets/ForkJoinPool.html-01072d03.js" as="script"><link rel="prefetch" href="/assets/JDBC.html-3e2f1926.js" as="script"><link rel="prefetch" href="/assets/OOM.html-5e4c3d36.js" as="script"><link rel="prefetch" href="/assets/Stringleishejichengbukebiandeyuanyin.html-834533cb.js" as="script"><link rel="prefetch" href="/assets/javaSEyinandian.html-8267187f.js" as="script"><link rel="prefetch" href="/assets/javaSEmianshiti（yi）.html-3782f994.js" as="script"><link rel="prefetch" href="/assets/javaSEmianshiti（er）.html-df27991a.js" as="script"><link rel="prefetch" href="/assets/javanacunquyu.html-bcc37252.js" as="script"><link rel="prefetch" href="/assets/javasuodefenlei.html-c2478026.js" as="script"><link rel="prefetch" href="/assets/jvmmianshiti.html-49c3fcca.js" as="script"><link rel="prefetch" href="/assets/synchronizedsuo.html-5dfb1e4f.js" as="script"><link rel="prefetch" href="/assets/volatileguanjianzi.html-af1b89af.js" as="script"><link rel="prefetch" href="/assets/duixiangchuangjiandeguocheng.html-9c7a7ad6.js" as="script"><link rel="prefetch" href="/assets/shuzu.html-6ace5125.js" as="script"><link rel="prefetch" href="/assets/zhengqueshiyongequalsfangfa.html-58a48810.js" as="script"><link rel="prefetch" href="/assets/xianchengchi.html-8e4103d2.js" as="script"><link rel="prefetch" href="/assets/Redisnacunmanliaozenmeban.html-9cbabb80.js" as="script"><link rel="prefetch" href="/assets/rabbitmqduilieyujiaohuanji.html-e744ec16.js" as="script"><link rel="prefetch" href="/assets/rediszhucongfuzhidekang.html-39c3ccf3.js" as="script"><link rel="prefetch" href="/assets/redisminglingchangjiandekang.html-c7d71bd5.js" as="script"><link rel="prefetch" href="/assets/redisshujuchijiuhuadekang.html-62e0535a.js" as="script"><link rel="prefetch" href="/assets/redisdenacuntaotaijizhi.html-6966e048.js" as="script"><link rel="prefetch" href="/assets/redisgaojitexing-weicaozuo.html-c081888f.js" as="script"><link rel="prefetch" href="/assets/daodishimeshihougaiyongmq.html-310bcded.js" as="script"><link rel="prefetch" href="/assets/mysqlzhucongfuzhi.html-2135446e.js" as="script"><link rel="prefetch" href="/assets/mysqlshujuqianyi.html-35aa5399.js" as="script"><link rel="prefetch" href="/assets/mysqlsuoyinyuyouhua.html-3f8dfdfe.js" as="script"><link rel="prefetch" href="/assets/mysqlbianmayuzifuji.html-8dfdb169.js" as="script"><link rel="prefetch" href="/assets/mysqlbiaosuoyuxingsuo.html-fc2b19fb.js" as="script"><link rel="prefetch" href="/assets/mysqldiaoyou.html-c0e504e3.js" as="script"><link rel="prefetch" href="/assets/nginxshiyongchangjingyuxiangguangainian.html-f6579e73.js" as="script"><link rel="prefetch" href="/assets/nginxchangyongpeizhi.html-1fbe1cd9.js" as="script"><link rel="prefetch" href="/assets/nginxpeizhiyufa.html-119240b8.js" as="script"><link rel="prefetch" href="/assets/Single thread vs child process vs worker threads vs cluster in nodejs.html-278f12bc.js" as="script"><link rel="prefetch" href="/assets/DNS.html-98a367b4.js" as="script"><link rel="prefetch" href="/assets/MQTT.html-44d9cbca.js" as="script"><link rel="prefetch" href="/assets/oauth2.html-5fb2291f.js" as="script"><link rel="prefetch" href="/assets/oidc.html-36aaa40b.js" as="script"><link rel="prefetch" href="/assets/pipyuangenghuan.html-ace2b1b4.js" as="script"><link rel="prefetch" href="/assets/pythondajianMiniotuchuang.html-930a9b50.js" as="script"><link rel="prefetch" href="/assets/stlmoxingjianmian.html-7ca81c57.js" as="script"><link rel="prefetch" href="/assets/ModelAttributezhujiedeshiyong.html-bdb4f688.js" as="script"><link rel="prefetch" href="/assets/Mybatisyiduiduo，duoduiyichaxun.html-4f8b1c90.js" as="script"><link rel="prefetch" href="/assets/Mybatisyijihuancun.html-a655baed.js" as="script"><link rel="prefetch" href="/assets/MybatiszhixingyitiaoSqlyujudeliucheng.html-0d07de1e.js" as="script"><link rel="prefetch" href="/assets/ResourceyuAutowiredzhujiedequbie.html-58d11247.js" as="script"><link rel="prefetch" href="/assets/SpringSecurity.html-78aecf2f.js" as="script"><link rel="prefetch" href="/assets/Springboot-quartzdingshirenwu.html-4ed3e002.js" as="script"><link rel="prefetch" href="/assets/SpringzhongBeandeshengmingzhouqi.html-787f2582.js" as="script"><link rel="prefetch" href="/assets/activitiliuchengyinqing.html-41e2b7f1.js" as="script"><link rel="prefetch" href="/assets/linuxyuwindowsqidongspringbootmingling.html-f149e45b.js" as="script"><link rel="prefetch" href="/assets/mavenmingling.html-40e9e03a.js" as="script"><link rel="prefetch" href="/assets/springbootfasongyoujian.html-3f0086a6.js" as="script"><link rel="prefetch" href="/assets/ByteBuddy.html-a5b3b74a.js" as="script"><link rel="prefetch" href="/assets/Reflections.html-e86d018b.js" as="script"><link rel="prefetch" href="/assets/seata.html-b5b7c035.js" as="script"><link rel="prefetch" href="/assets/404.html-a9de0bc8.js" as="script"><link rel="prefetch" href="/assets/reco-valine-a195b6e9.js" as="script"><link rel="prefetch" href="/assets/giscus-2a044aea-497f0bd4.js" as="script">
    <link rel="preload" href="/assets/style-72da0c4e.css" as="style"><link rel="stylesheet" href="/assets/style-72da0c4e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><div class="common-wrapper series--no"><header class="navbar-container" style="top:0;"><div class="site-brand nav-item"><img class="logo" src="/logo.png" alt="Knightdreams&#39;Blog"><a href="/" class="site-name can-hide">Knightdreams&#39;Blog</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/docs/resume.html" class="link" aria-label="简历"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->简历<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/concept/1/" class="link" aria-label="分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->分类<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/tags/concept/1/" class="link" aria-label="标签"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->标签<!--]--></span></span><!--[--><!--]--></a></div><!--]--></nav><span class="xicon-container btn-toggle-dark-mode btn--dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></header><!----><div class="mobile-menus-container"><nav class="navbar-links mobile"><!--[--><div class="navbar-links__item"><a href="/docs/resume.html" class="link" aria-label="简历"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->简历<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/concept/1/" class="link" aria-label="分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->分类<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/tags/concept/1/" class="link" aria-label="标签"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->标签<!--]--></span></span><!--[--><!--]--></a></div><!--]--></nav><div class="appearance"><span>Appearance</span><span class="xicon-container btn-toggle-dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span></div></div><div class="series-mask"></div><aside class="series-container"><div class="site-brand"><img class="logo" src="/logo.png" alt="Knightdreams&#39;Blog"><a href="/" class="site-name can-hide">Knightdreams&#39;Blog</a></div><!--[--><!--]--></aside><!--[--><main class="page-container"><h1 class="page-title">Spring声明式事务</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->knight<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->2020-03-10 18:55:51<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->java/framework<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->java Spring<!--]--></span></span><!----></div><div class="theme-reco-default-content"><div><h4 id="_1、什么是事务" tabindex="-1"><a class="header-anchor" href="#_1、什么是事务" aria-hidden="true">#</a> 1、什么是事务</h4><blockquote><p>事务就是把一系列的动作当成一个独立的工作单元，这些动作要么全部完成，要么全部不起作用。就是把一系列的操作当成原子性去执行。</p></blockquote><p><strong>事务的四个属性</strong> ACID</p><ol><li>原子性（atomicity）事务是原子性操作，由一系列动作组成，事务的原子性确保动作要么全部完成，要么完全不起作用</li><li>一致性（consistency）一旦所有事务动作完成，事务就要被提交。数据和资源处于一种满足业务规则的一致性状态中</li><li>隔离性（isolation）可能多个事务会同时处理相同的数据，因此每个事务都应该与其他事务隔离开来，防止数据损坏</li><li>持久性（durability）事务一旦完成，无论系统发生什么错误，结果都不会受到影响。通常情况下，事务的结果被写到持久化存储器中</li></ol><h4 id="_2、spring中的事务管理" tabindex="-1"><a class="header-anchor" href="#_2、spring中的事务管理" aria-hidden="true">#</a> 2、Spring中的事务管理</h4><blockquote><p>Spring在不同的事务管理API之上定义了一个抽象层，使得开发人员不必了解底层的事务管理API就可以使用Spring的事务管理机制。Spring支持编程式事务管理和声明式的事务管理。</p></blockquote><p><strong>编程式事务管理</strong></p><blockquote><p>将事务管理代码嵌到业务方法中来控制事务的提交和回滚</p><p>缺点：必须在每个事务操作业务逻辑中包含额外的事务管理代码</p></blockquote><p><strong>声明式事务管理</strong></p><blockquote><p>一般情况下比编程式事务好用。将事务管理代码从业务方法中分离出来，以声明的方式来实现事务管理。将事务管理作为横切关注点，通过aop方法模块化。Spring中通过Spring AOP框架支持声明式事务管理。</p></blockquote><h4 id="_3、事务管理器" tabindex="-1"><a class="header-anchor" href="#_3、事务管理器" aria-hidden="true">#</a> 3、事务管理器</h4><p>Spring的核心事务管理抽象，管理封装了一组独立于技术的方法，无论使用Spring的哪种事务管理策略（编程式或者声明式）事务管理器都是必须的。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span>PlatformTransactionManager</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>JDBC事务</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Hibernate事务</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.orm.hibernate3.HibernateTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sessionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sessionFactory<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>JPA事务</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.orm.jpa.JpaTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sessionFactory<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sessionFactory<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4、声明式事务属性" tabindex="-1"><a class="header-anchor" href="#_4、声明式事务属性" aria-hidden="true">#</a> 4、声明式事务属性</h4><h5 id="_4-1-传播行为" tabindex="-1"><a class="header-anchor" href="#_4-1-传播行为" aria-hidden="true">#</a> 4.1 传播行为</h5><blockquote><p>事务方法被另一个事务方法调用时，必须指定事务应该如何传播。例如方法可能继续在现有事务中运行，也可能开启一个新的事务，并在自己的事务运行。spring中的事务传播行为可以由传播属性指定。<strong>spring指定了7种类传播行为</strong>。</p></blockquote><ul><li><p><strong>REQUIRED</strong></p><blockquote><p>如果有事务正在运行，当前的方法就在这个事务内运行，否则就开启一个新的事务，并在自己的事务内运行。默认的传播行为</p></blockquote></li><li><p><strong>REQUIRED_NEW</strong></p><blockquote><p>当前方法必须启动新事务，并在自己的事务内运行，如果有事务正在运行，则将它挂起</p></blockquote></li><li><p><strong>SUPPORTS</strong></p><blockquote><p>如果有事务在运行，当前的方法就在这个事务内运行，否则可以不运行在事务中</p></blockquote></li><li><p><strong>NOT_SUPPORTED</strong></p><blockquote><p>表示该方法不应该运行在事务中。如果存在当前事务，在该方法运行期间，当前事务将被挂起。</p></blockquote></li><li><p><strong>MANDATORY</strong> mandatory(强制性的)</p><blockquote><p>表示当前方法必须运行在事务中，如果没有正在运行的事务，就会抛出异常</p></blockquote></li><li><p><strong>NEVER</strong></p><blockquote><p>表示当前方法不应该运行在事务中，如果有正在进行的事务，就会抛出异常</p></blockquote></li><li><p><strong>NESTED</strong></p><blockquote><p>如果有事务在运行，当前的方法就应该在这个事务的嵌套事务内运行。嵌套的事务可以独立于当前事务进行单独地提交或回滚。如果当前事务不存在，那么其行为与REQUIRED一样。</p></blockquote></li></ul><h5 id="_4-2-事务的隔离级别" tabindex="-1"><a class="header-anchor" href="#_4-2-事务的隔离级别" aria-hidden="true">#</a> 4.2 事务的隔离级别</h5><p>并发事务会导致发生以下三种类型的问题</p><ul><li><p>脏读</p><blockquote><p>发生在一个事务读取了另一个事务改写尚未提交的数据，改写的数据回滚了，那么第一个事务获取的数据无效</p></blockquote></li><li><p>不可重复度</p><blockquote><p>当同一个事务执行两次以上相同的查询时，每次都得到不同的数据。一般因为另一并发事务在两次查询期间进行了更新</p></blockquote></li><li><p>幻读：</p><blockquote><p>第一个事务读取了一些数据，此时第二个事务在该表中插入了一些数据，这时第一个数据再读取相同的数据时就会多几行</p></blockquote></li></ul><p><strong>不可重复读和幻读的区别</strong>：不可重复读侧重点在相同数据被修改，而幻读是删除或新增</p><blockquote><p>从理论上讲，事务应该完全隔离，避免并发事务导致的问题，但是这样可能对性能产生极大影响，因为事务必须按顺序进行了。</p><p>所以在实际的开发中，为了提升性能，事务会以比较低的隔离级别运行。</p></blockquote><p><strong>spring中事务的隔离级别可以通过隔离属性指定</strong></p><ul><li><p><strong>DEFAULT</strong></p><blockquote><p>使用底层数据库默认的隔离级别。大部分数据库隔离级别为READ_COMMITED</p></blockquote></li><li><p><strong>READ_COMMITED</strong></p><blockquote><p>只允许事务读取已经被其他事务提交的更改。可以避免脏读</p></blockquote></li><li><p><strong>READ_UNCOMMITED</strong></p><blockquote><p>允许事务读取未被其他事务提交的更改。什么都不可避免</p></blockquote></li><li><p><strong>REPEATABLE_READ</strong></p><blockquote><p>确保事务可以从一个字段中读取相同的值。在这个事务持续期间，不许其它事务对这个字段进行更新，可以避免脏读，不可重复读</p></blockquote></li><li><p><strong>SERIALIZABLE</strong></p><blockquote><p>确保事务可以从一个表中读取相同的行，在这个事务持续期间，禁止其他事务对该表执行插入，更新，删除。所有的并发问题都能避免，但是性能比较低。</p></blockquote></li></ul><p><strong>注意</strong>：事务的隔离级别需要底层数据库引擎的支持，而不是应用程序或者框架的支持</p><blockquote><p>Oracle支持2种事务隔离级别：READ_COMMITED，SERIALIZABLE</p><p>MySQL支持4种事务隔离级别</p></blockquote><h5 id="_4-3-回滚规则" tabindex="-1"><a class="header-anchor" href="#_4-3-回滚规则" aria-hidden="true">#</a> 4.3 回滚规则</h5><blockquote><p>默认情况下只有未检查异常（RuntimeException和Error类型的异常）会导致事务回滚。事务的回滚规则可以通过属性管理 rollbackFor：遇到时必须进行回滚</p><p>noRollbackFor：一组异常类，遇到时必须不能回滚</p></blockquote><h5 id="_4-4-只读属性" tabindex="-1"><a class="header-anchor" href="#_4-4-只读属性" aria-hidden="true">#</a> 4.4 只读属性</h5><blockquote><p>如果事务只读数据但不修改可以通过配置只读事务属性，帮助数据库引擎优化事务。只读事务属性：表示这个事务只读读取数据，但是不更新数据</p></blockquote><h4 id="_5、声明式管理事务" tabindex="-1"><a class="header-anchor" href="#_5、声明式管理事务" aria-hidden="true">#</a> 5、声明式管理事务</h4><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>	<span class="token comment">&lt;!-- 1. 配置事务管理器 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- 2. 配置事务属性 --&gt;</span>
	<span class="token comment">&lt;!--&lt;tx:advice&gt;元素声明事务通知--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 根据方法名指定事务的属性 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token comment">&lt;!--propagation配置事务传播行为--&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>purchase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRES_NEW<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token comment">&lt;!--isolation配置事务的隔离级别--&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>update*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isolation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SERIALIZABLE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token comment">&lt;!--rollback-for配置事务遇到异常必须回滚，no-rollback-for配置事务遇到异常必须不能回滚--&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>add*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rollback-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.io.IOException<span class="token punctuation">&quot;</span></span> <span class="token attr-name">no-rollback-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.dmsd.spring.tx.BookStockException<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token comment">&lt;!--read-only配置事务只读属性--&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>find*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
			<span class="token comment">&lt;!--timeout配置事务的超时属性--&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>
	
	<span class="token comment">&lt;!-- 3. 配置事务切入点, 以及把事务切入点和事务属性关联起来 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(* com.atguigu.spring.tx.xml.service.*.*(..))<span class="token punctuation">&quot;</span></span> 
			<span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txPointCut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txPointCut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>	
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-2用-transactional-注解声明式地管理事务" tabindex="-1"><a class="header-anchor" href="#_5-2用-transactional-注解声明式地管理事务" aria-hidden="true">#</a> 5.2用 @Transactional 注解声明式地管理事务</h5><p>Spring中注解的方式@Transactional标注事务方法。为了将方法定义为支持事务处理，可以在方法上添加@Transactional注解。根据Spring AOP基于代理机制，只能标注公有方法。如果在类上标注@Transactional注解，那么这个类中所有公有方法都会被定义为支持事务。</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>   <span class="token comment">&lt;!-- 配置事务管理器 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> 
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- 启用事务注解 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>annotation-driven</span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在方法上添加</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>   <span class="token comment">// 添加事务注解</span>
   <span class="token comment">// 1.使用 propagation 指定事务的传播行为, 即当前的事务方法被另外一个事务方法调用时</span>
   <span class="token comment">//   如何使用事务, 默认取值为 REQUIRED, 即使用调用方法的事务  REQUIRES_NEW: 方法自己的事务, 调用的事务方法的事务被挂起. </span>
   <span class="token comment">// 2.使用 isolation 指定事务的隔离级别, 最常用的取值为 READ_COMMITTED</span>
   <span class="token comment">// 3.默认情况下 Spring 的声明式事务对所有的运行时异常进行回滚. 也可以通过对应的属性进行设置. 通常情况下取默认值即可. </span>
   <span class="token comment">// 4.使用 readOnly 指定事务是否为只读. 表示这个事务只读取数据但不更新数据, </span>
   <span class="token comment">//   这样可以帮助数据库引擎优化事务. 若真的事一个只读取数据库值的方法, 应设置 readOnly=true</span>
   <span class="token comment">// 5.使用 timeout 指定强制回滚之前事务可以占用的时间.</span>
	<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation<span class="token operator">=</span><span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRES_NEW</span><span class="token punctuation">,</span>
			isolation<span class="token operator">=</span><span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">READ_COMMITTED</span><span class="token punctuation">,</span>
			noRollbackFor<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">UserAccountException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			rollbackFor <span class="token operator">=</span> <span class="token class-name">IOException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
			readOnly<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">,</span>
			timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">purchase</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> isbn<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6、事务失效" tabindex="-1"><a class="header-anchor" href="#_6、事务失效" aria-hidden="true">#</a> 6、事务失效</h4><p>​ 因为spring事务是基于aop的代理机制，当方法中调用this本身的方法时候即使在this的方法标明事务注解，但是事务注解会失效。如下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">purchase</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> isbn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> isbn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> isbn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//1. 获取书的单价</span>
	<span class="token keyword">int</span> price <span class="token operator">=</span> bookShopDao<span class="token punctuation">.</span><span class="token function">findBookPriceByIsbn</span><span class="token punctuation">(</span>isbn<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2. 更新数的库存</span>
	bookShopDao<span class="token punctuation">.</span><span class="token function">updateBookStock</span><span class="token punctuation">(</span>isbn<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3. 更新用户余额</span>
	bookShopDao<span class="token punctuation">.</span><span class="token function">updateUserAccount</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原因：因为调用this本身方法不走代理机制，这个时候可以通过配置解决这个问题。</p><p>解决事务失效 在配置中添加如下内容</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--开启aspectj代理，并暴露aop代理到ThreadLocal--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span> <span class="token attr-name">expose-proxy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>将上述调用的地方改成如下</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">purchase</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> isbn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BookShopServiceImpl</span><span class="token punctuation">)</span><span class="token class-name">AopContext</span><span class="token punctuation">.</span><span class="token function">currentProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> isbn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Last Updated 11/23/2023, 9:14:21 AM<!--]--></span></span></div></footer><!----><!----></main><!--]--><!----></div></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-738c8638.js" defer></script>
  </body>
</html>
